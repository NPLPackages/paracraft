<!-- "script/apps/Aries/Creator/Game/Tasks/Race/RacePage.html" -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>
</head>
<body>
    <pe:mcml>
        <script refresh="true" type="text/npl" src="RacePage.lua">
            <![CDATA[
            local RacePage = NPL.load("(gl)script/apps/Aries/Creator/Game/Tasks/Race/RacePage.lua");
            RacePage.OnInit()
            function ClosePage()
                local pageCtrl = document:GetPageCtrl();
                pageCtrl:CloseWindow(true)
            end

            function GetItemData()
                return RacePage.Datas
            end

            function GetItemListData()
                return RacePage.Datas[RacePage.index].ListData
            end

            function GetItemListDataTitle(index)
                return RacePage.Datas[RacePage.index].ListData[index].name
            end

            function CheckRaceItemHasEnterPage()
                local length = #RacePage.Datas[RacePage.index].enterPage
                return length > 0
            end

            function GetRaceEnterPageName()
                if CheckRaceItemHasEnterPage() then
                    return RacePage.Datas[RacePage.index].enterPage[1].name
                else
                    return ""
                end
            end

            function GetRaceEnterPageNodeName()
                if CheckRaceItemHasEnterPage() then
                    return RacePage.Datas[RacePage.index].enterPage[1].node_name
                else
                    return ""
                end
            end

            function ShowVip()
                local VipPage = NPL.load("(gl)script/apps/Aries/Creator/Game/Tasks/User/VipPage.lua");
                VipPage.ShowPage();
            end

            function ClickCompetition()
                RacePage.ClickCompetition()
            end

            function GetTooltip(index)
                return RacePage.Datas[index];
            end

            function GetRaceContent(index)
                return RacePage.Datas[RacePage.index].content;
            end

            function GetRaceTime(index)
                return RacePage.Datas[index].time;
            end

            function GetRaceType(index)
                return RacePage.Datas[index].race;
            end

            function GetCurrentRaceType()
                return RacePage.Datas[RacePage.index].race;
            end

            function GetCurrentRaceSignUpEndTime()
                return RacePage.Datas[RacePage.index].signUpBtnInfo.tooltip;
            end

            function CheckSignUpEndTime()
                return RacePage.CheckSignUpEndTime()
            end

            function CheckRaceEnd()
                return RacePage.CheckRaceEnd()
            end

            function OnRaceClick(index)
                RacePage.OnRaceClick(index)
            end

            function OnClickRaceItem(index)
                RacePage.OnClickRaceItem(index)
            end

            function OnEnterPage(name)
                RacePage.OnEnterPage(name)
            end

            function CheckIsCurentClickRace(index)
                return index == RacePage.index
            end

            function GetSignUpBtnText()
                return RacePage.Datas[RacePage.index].leftTopBtnInfo.btnText
            end

            function GetIcon(index)
                return RacePage.Datas[RacePage.index].ListData[index].icon
            end

            function OnClickOfficialActivities()
                local url = L"https://keepwork.com/cp/home"
                ParaGlobal.ShellExecute("open", url, "", "", 1)
            end

            
            function OnMouseEnter(name,mcmlNode)
                local tipUiName = mcmlNode:GetAttribute("tip")
                RacePage.OnMouseEnter(tipUiName)
            end

            function OnMouseLeave(name,mcmlNode)
                local tipUiName = mcmlNode:GetAttribute("tip")
                RacePage.OnMouseLeave(tipUiName)
            end

            function GetTopImg()
                local bgs = {} 
                for i = 1, #RacePage.ItemData do 
                    if RacePage.ItemData[i].visible then
                        table.insert(bgs,string.format("Texture/Aries/Creator/keepwork/RedSummerCamp/shentongbei/tu%d_875X255_32bits.png#0 0 875 255",i))
                    end
                end
                return bgs[RacePage.index]
            end
            
            ]]>
        </script>
        <pe:container  alignment="_fi" width="100%" height="100%" style="background-color:#dcdcdc">
            <pe:container  alignment="_fi" width="100%" height="100%" class="red_summer_camp_bg">
                <!--背景水印-->
                   <div>
                       <div style="position:relative;margin-left:24px;margin-top:104px;width:512px;height:256px;background:url(Texture/Aries/Creator/keepwork/RedSummerCamp/courses/watermark_bg_32bits.png);" />
                       <div style="position:relative;margin-left:557px;margin-top:26px;width:512px;height:256px;background:url(Texture/Aries/Creator/keepwork/RedSummerCamp/courses/watermark_bg_32bits.png);" />
                       <div style="position:relative;margin-left:103px;margin-top:282px;width:512px;height:256px;background:url(Texture/Aries/Creator/keepwork/RedSummerCamp/courses/watermark_bg_32bits.png);" />
                       <div style="position:relative;margin-left:879px;margin-top:311px;width:512px;height:256px;background:url(Texture/Aries/Creator/keepwork/RedSummerCamp/courses/watermark_bg_32bits.png);" />
                       <div style="position:relative;margin-left:438px;margin-top:477px;width:512px;height:256px;background:url(Texture/Aries/Creator/keepwork/RedSummerCamp/courses/watermark_bg_32bits.png);" />
                   </div>
                <!--Vip&官方活动-->
                <pe:container alignment="_rt" style="background:url();">
                    <input type="button" value='' onclick="OnClickOfficialActivities" class="" style="margin-right:20px;margin-top:8px;width:66px;height:70px;background: url(Texture/Aries/Creator/keepwork/RedSummerCamp/shentongbei/icon_66X70_32bits.png#0 0 66 70);" />
                    <%=GameLogic.GetFilters():apply_filters('get_vip_time_icon_div', 8, "ShowVip")%>
                    <input type="button" value='' onclick="ShowVip" class="red_summer_camp_open_vip_btn" style="margin-right:20px;margin-top:6px;" />
                </pe:container>
                <!--Close-->
                <pe:container alignment="_lt" style="width:171px;height:58px;background:url(Texture/Aries/Creator/keepwork/RedSummerCamp/courses/courses_32bits.png#7 248 171 58);">
                    <input type="button" onclick="ClosePage" class="red_summer_camp_back_arrow" style="margin-left:30px;margin-top:10px;" />
                    <div style="margin-left: 94px; margin-top: -51px; width: 294px; height: 64px; background: url(Texture/Aries/Creator/keepwork/RedSummerCamp/shentongbei/shentongbei_32bits.png#15 790 294 64);">
                        <div style="margin-top: 22px; margin-left: 100px; width: 79px; height: 20px; background: url(Texture/Aries/Creator/keepwork/RedSummerCamp/shentongbei/zi1_79X20_32bits.png#0 0 79 20);"></div>
                    </div>
                </pe:container>
                <!-- 左边容器 -->
                <pe:container alignment="_lt" style="background: url(Texture/Aries/Creator/keepwork/RedSummerCamp/shentongbei/di1_128X128_32bits.png#0 0 128 128:32 32 32 32);position: absolute; top: 80px; left: 10px; width: 366px; height:610px;">
                    <div style="background: url(Texture/Aries/Creator/keepwork/RedSummerCamp/shentongbei/di2_128X128_32bits.png#0 0 128 128:32 32 32 32);position: relative; margin-top: 4px;  margin-left: 4px; width: 358px; height:212px;">
                        <div style="color:#ffffff;font-size: 20px; position: relative;padding-top:30px;padding-left:22px;padding-right:22px;height: 180px; overflow-y: auto;font-weight: bold;"> <%=GetCurrentRaceType()%></div>
                        <div style="position: absolute;left: 20px;top: 94px; width: 326px;height:40px;">
                            <pe:if condition="<%=CheckRaceEnd() == false%>">
                                <pe:label name="pre_text" style="font-size: 16px;margin-left: 16px;margin-top: 8px; text-align:left;width:100px;height:30px;color: #ffffff;" >距大赛结束</pe:label>
                                <pe:label name="down_time_text" style="font-size: 18px;margin-left: 10px;margin-top: 7px; text-align:left;width:226px;height:30px;font-weight:bold;color: #ffffff;" ></pe:label>
                            </pe:if>

                            <pe:if condition="<%=CheckRaceEnd() == true%>">
                                <pe:label name="down_time_text" style="font-size: 18px;margin-left: 0px;margin-top: 8px; text-align:center;width:326px;height:30px;font-weight:bold;color: #ffffff;" >距大赛结束 已结束</pe:label>
                            </pe:if>
                        </div>
                        <pe:if condition="<%=CheckSignUpEndTime() == false%>">
                            <div style="position: absolute;margin-left: 103px;margin-top: 134px; width: 152px;height:52px;">
                                <input type="button"  tip = "mouse_enter_tip" onclick="ClickCompetition" onmouseenter="OnMouseEnter" onmouseleave="OnMouseLeave" value="<%=GetSignUpBtnText()%>" style="font-weight:bold;color:#1f1f1f;font-size: 18px;text-offset-y:-2;margin-left:0px;margin-top:0px;width: 152px;height: 52px;background: url(Texture/Aries/Creator/keepwork/RedSummerCamp/shentongbei/btn2_32X52_32bits.png#0 0 32 52:12 12 12 12);" />
                            </div>
                        </pe:if>
                        <pe:if condition="<%=CheckSignUpEndTime() == true%>">
                            <div style="position: absolute;margin-left: 103px;margin-top: 134px; width: 152px;height:52px;">
                                <input type="button"  tip = "mouse_enter_tip" class = "kp_gray_button" onclick="" onmouseenter="OnMouseEnter" onmouseleave="OnMouseLeave" value="<%=GetSignUpBtnText()%>" style="font-weight:bold;color:#1f1f1f;font-size: 18px;text-offset-y:-2;margin-left:0px;margin-top:0px;width: 152px;height: 52px;" />
                            </div>
                        </pe:if>
                        <!-- 鼠标悬浮提示 -->
                        <pe:container  zorder = "2" uiname = "mouse_enter_tip" style="background: url(Texture/Aries/Creator/keepwork/RedSummerCamp/shentongbei/tipbj_32bits.png#0 0 32 32:12 12 12 12);position: relative; margin-top: 94px;  margin-left: 39px; width: 280px; height:38px;">
                            <div style="font-size: 12px;color:#ffffff;text-align:center;width: 280px;height: 32px;margin-top: 8px;">
                                <%=GetCurrentRaceSignUpEndTime()%>
                            </div>
                        </pe:container>
                    </div>
                    <div style="background:url();position: absolute; top: 215px; left: 11px; width: 344px; height:360px;">
                        <div style="background: url(Texture/Aries/Creator/keepwork/RedSummerCamp/shentongbei/zi2_139X36_32bits.png#0 0 139 36); position: relative;margin-left:10px;margin-top:0px;width:139px;height: 36px; font-weight:bold;"></div>
                        <div style="float:left;">
                            <pe:gridview style="margin-left:13px;margin-top:45px;width:344px;height:326px;" RememberScrollPos = true name="item_gridview" CellPadding="0" VerticalScrollBarStep="20" VerticalScrollBarOffsetX="4" AllowPaging="false" ItemsPerLine="1" DefaultNodeHeight = "60" 
                                DataSource="<%=GetItemData()%>">
                                <Columns>
                                    <div onclick = "OnRaceClick"  name = '<%=Eval("index")%>'  style="width:330px;height:60px;">
                                        <div style="background:url(Texture/Aries/Creator/keepwork/RedSummerCamp/shentongbei/yuan_14X14_32bits.png#0 0 14 14);margin-left:3px; margin-top:7px;width: 14px; height:14px;"></div>
                                        <div  style="font-size:14px;color:#ffffff;text-align:left;margin-left:36px;margin-top: -18px;">
                                            <%=GetRaceTime(Eval('index'))%>
                                        </div>
                                        <pe:if condition="<%=CheckIsCurentClickRace(Eval('index')) == true%>">
                                            <div  style="font-size: 12px;color:#FFA902;text-align:left;overflow-y: auto;margin-left:36px;font-weight:bold;width: 270px;">
                                                <%=GetRaceType(Eval('index'))%>
                                            </div>
                                        </pe:if>
                                        <pe:if condition="<%=CheckIsCurentClickRace(Eval('index')) == false%>">
                                            <div style="font-size: 12px;color:#ffffff;text-align:left;overflow-y: auto;margin-left:36px;font-weight:bold;width: 270px">
                                                <%=GetRaceType(Eval('index'))%>
                                            </div>
                                        </pe:if>
                                    </div>  
                                </Columns>
                                <EmptyDataTemplate>
                                    <b>暂无赛事</b>
                                </EmptyDataTemplate>
                            </pe:gridview>
                       </div>
                    </div>
                </pe:container>
                <!-- 右边容器 -->
                <pe:container alignment="_lt" style="background:url();position: absolute; top: 95px; left: 366px; width: 914px; height:578px;">
                    <!-- 顶部宣传图 -->
                    <img src='<%=GetTopImg()%>' style='position: absolute; margin-top: 0px; margin-left: 28px;width: 875px; height: 255px; ' />
                    <pe:container alignment="_ctl" style="background-color: #00000000;width: 858px; height:220px;position: relative; margin-left: 28px;margin-top: 76px;">
                        <div style="font-size: 18px; height: 180px; overflow-y: auto; margin-left: 0px;margin-top: 24px;;color:#212122;">
                            <%=GetRaceContent()%>
                        </div>
                    </pe:container>
                   
                    <pe:container alignment="_lb" style="background:url();width: 914px; height:140px;position: relative; margin-bottom: 10px;">
                        <pe:repeat DataSource="<%=GetItemListData()%>">
                            <pe:repeatitem>
                                <div zorder="-2" onclick= "OnClickRaceItem" name ='<%=Eval("index")%>' style="float:left;margin-left: 18px;margin-top: 30px; background:url(Texture/Aries/Creator/keepwork/RedSummerCamp/main/bjk_64X64_32bits.png#0 0 64 64:24 24 24 24);width: 126px; height: 126px;">
                                    <%=GetIcon(Eval("index"))%>
                                    <div style="margin-left: 13px;margin-top:81px; position: relative;width: 100px;height:26px;background: url(Texture/Aries/Creator/keepwork/RedSummerCamp/shentongbei/hei_100X26_32bits.png#0 0 100 26);">
                                        <div style="position: relative;margin-left: 0px;margin-top: -2x; width:98px;height: 24px; line-height: 24px; text-align:center; color: #ffffff; ">
                                            <%=GetItemListDataTitle(Eval('index'))%>
                                        </div>
                                    </div>
                                </div>
                            </pe:repeatitem>
                        </pe:repeat>
                        <pe:if condition="<%=CheckRaceItemHasEnterPage() == true%>">
                            <pe:container alignment="_rb" style="width: 180px; height:52px;margin-bottom: 0px;margin-right: 30px;background:url();">
                                <input type="button" name ='<%=GetRaceEnterPageNodeName()%>' onclick="OnEnterPage" value="<%=GetRaceEnterPageName()%>" style="font-weight:bold;color:#1f1f1f;font-size: 18px;text-offset-y:-2;margin-left:0px;margin-top:0px;width: 180px;height: 52px;background: url(Texture/Aries/Creator/keepwork/RedSummerCamp/shentongbei/btn2_32X52_32bits.png#0 0 32 52:12 12 12 12);" />    
                            </pe:container>
                        </pe:if>
                    </pe:container>
                </pe:container>
            </pe:container>
        </pe:container>

    </pe:mcml>
</body>
</html>

