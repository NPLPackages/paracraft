<!-- "script/apps/Aries/Creator/Game/GUI/CheckpointListPage.html" -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>
</head>
<body>
    <pe:mcml>
        <script refresh="false" type="text/npl" src="">
            <![CDATA[
			NPL.load("(gl)script/apps/Aries/Creator/Game/GUI/CheckpointListPage.lua");
			EntityManager = commonlib.gettable("MyCompany.Aries.Game.EntityManager");
			CheckpointListPage = commonlib.gettable("MyCompany.Aries.Game.GUI.CheckpointListPage");
			CheckpointListPage.OnInit()
            function ClosePage()
				CheckpointListPage.OnClose();
            end
			
			function DS_Items(index)
				local ds = CheckpointListPage.getCheckPointDs();
				if ds then
					if(index == nil) then
						return #ds;
					else
						return ds[index];
					end
				end
			end

			function CheckPointIsSelected(index)
				if(CheckpointListPage.isSelected(index)) then
					return true;
				else
					return false;
				end
			end

			function SelectCheckPoint(name,mcmlNode)
				local index = mcmlNode:GetAttribute("param1");
				index = tonumber(index);
				local isOpen = mcmlNode:GetAttribute("param2");				
				CheckpointListPage.SetCurCheckpoint(index, isOpen);	
				if CheckpointListPage.LoadCheckPoint() then
					ClosePage();
				end				
			end

			function ShowStatusStr(isOpen)
				if isOpen then
					return "";
				else
					return "未解锁";
				end
			end
			
			function GetPreviewImagePath(cpname)
				local imgPath = CheckpointListPage.GetPreviewImagePath(cpname);
				if imgPath == nil or imgPath == "" then
					imgPath="Texture/Aries/Creator/Theme/GameCommonIcon_32bits.png#208 89 21 21:4 4 4 4";
				end
				return imgPath;
			end
			
			function GetLockColor(isOpen)
				if isOpen then
					return "#ffffffff";
				else
					return "#ffffff90";
				end				
			end
			
			function GetTooltip(isOpen)
				if isOpen then
					return L"前往存盘点";
				else
					return L"未解锁";
				end				
			end
            ]]>
        </script>
        <pe:container class="mc_border" style="color:#cccccc;">
            <div width="100%" style="padding:5px;">
                <div style="margin-top:3px;margin-left:5px;float:left;padding:2px;background:url(Texture/Aries/Creator/Theme/GameCommonIcon_32bits.png#308 89 34 34)">
                    <pe:mc_block block_id='<%=Game.block_types.names.Checkpoint%>' style="width:32px;height:32px;" />
                </div>
                <div style="float:left;width:200px;margin-left:100px;">
                    <div>
                        <div style="float:left"><%=L"名称:"%></div>
                        <%=tostring(L"存盘点")%>
                    </div>
                    <div>
                        <div style="float:left">ID:</div>
                        <%=tostring(Game.block_types.names.Checkpoint)%>
                    </div>
                </div>
                <div style="float:left;width:100px;margin-left:300px;">
                    <input type="button" name="save" onclick="ClosePage" value='<%=L"关闭"%>' class="mc_big_button" style="margin-top:5px;min-width:80px;" />
                </div>
            </div>
            <div width="100%">
                <div class="mc_line" width="100%" height="1"></div> 
                <div>					
					<pe:gridview style="margin-top:5px;height:260px;" name="gvwCheckPoints" CellPadding="4" VerticalScrollBarStep="160" VerticalScrollBarOffsetX="0" AllowPaging="false" ItemsPerLine="3" DefaultNodeHeight = "0" 
						DataSource='<%=DS_Items%>'>
						<Columns>
							<div style='<%=format("background-color:%s;margin-left:10px;margin-top:15px;width:240px;height:160px;background:url(%s)", GetLockColor(Eval("isOpen")), GetPreviewImagePath(Eval("name")) or "")%>'>
									<div style="float:left;width:240px;font-size:22px;color:#000000;text-align:center;">
										<%= string.format("%s:%s", Eval("id"), Eval("name")) %>
									</div>
									
									<div style="float:left;width:240px;margin-left:0px;text-align:center;">
										<%= ShowStatusStr(Eval("isOpen") or false) %>
									</div>
									<input type="button" onclick="SelectCheckPoint" name="btn_goCheckPoint" tooltip='<%= GetTooltip(Eval("isOpen")) %>' param1='<%=Eval("index") %>' param2='<%=Eval("isOpen")%>' style="width:240px;height:160px;background:"/>
							</div>
							
						</Columns>
						
						<EmptyDataTemplate>
						</EmptyDataTemplate>						
					</pe:gridview>
                </div>
            </div>			
        </pe:container>
    </pe:mcml>
</body>
</html>